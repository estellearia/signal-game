<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Signal Sync</title>
<style>
body {
  background: black;
  color: white;
  font-family: 'Press Start 2P', monospace;
  text-align: center;
  padding: 20px;
}

#gameCanvas {
  border: 3px solid white;
  margin: 20px auto;
  display: block;
  background-color: #111;
}

#instruction {
  font-size: 10px;
  margin-top: 16px;
  color: #87cefa;
}

#round {
  margin-top: 10px;
  font-size: 10px;
  color: #ffeb3b;
}

button {
  background: none;
  border: 2px solid white;
  color: white;
  font-family: 'Press Start 2P', monospace;
  font-size: 10px;
  padding: 8px;
  margin-top: 16px;
  cursor: pointer;
}
</style>
</head>
<body>
<h2>SIGNAL SYNC</h2>
<canvas id="gameCanvas" width="300" height="150"></canvas>
<div id="round">Round 1</div>
<div id="instruction">Press SPACE when the dot aligns with the center line!</div>
<button onclick="startGame()">Start</button>

<audio id="blip" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>
<audio id="winSound" src="https://www.fesliyanstudios.com/play-mp3/6675" preload="auto"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const blip = document.getElementById("blip");
const winSound = document.getElementById("winSound");

let rounds = [
  { speed: 2, tolerance: 15, msg: "Press SPACE when the dot aligns with the center line!" },
  { speed: 3.5, tolerance: 10, msg: "The pace is faster now. Time it just right!" },
  { speed: 5, tolerance: 6, msg: "Final sync. Trust your instinct." }
];

let currentRound = 0;
let x = 0;
let direction = 1;
let running = false;
let success = false;

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";
  ctx.fillRect(canvas.width / 2 - 2, 0, 4, canvas.height); // center line

  ctx.beginPath();
  ctx.arc(x, canvas.height / 2, 10, 0, 2 * Math.PI);
  ctx.fillStyle = "cyan";
  ctx.fill();

  if (running) {
    x += rounds[currentRound].speed * direction;
    if (x > canvas.width - 10 || x < 10) direction *= -1;
    requestAnimationFrame(draw);
  }
}

function startGame() {
  document.querySelector("button").style.display = "none";
  document.getElementById("round").innerText = `Round ${currentRound + 1}`;
  document.getElementById("instruction").innerText = rounds[currentRound].msg;
  x = 10;
  direction = 1;
  success = false;
  running = true;
  draw();
}

window.addEventListener("keydown", (e) => {
  if (!running || success) return;
  if (e.code === "Space") {
    const center = canvas.width / 2;
    const tolerance = rounds[currentRound].tolerance;
    if (Math.abs(x - center) < tolerance) {
      blip.currentTime = 0;
      blip.play();
      success = true;
      running = false;
      setTimeout(() => {
        currentRound++;
        if (currentRound < rounds.length) {
          document.querySelector("button").innerText = "Next Round";
          document.querySelector("button").style.display = "inline-block";
        } else {
          document.getElementById("round").innerText = "★ All rounds synced! You're in tune. ★";
          document.getElementById("instruction").innerText = "Thank you for listening. I'm here.";
          winSound.play();
        }
      }, 500);
    } else {
      document.getElementById("instruction").innerText = "Missed it! Wait for the next pass...";
      setTimeout(() => {
        document.getElementById("instruction").innerText = rounds[currentRound].msg;
      }, 1200);
    }
  }
});
</script>
</body>
</html>
